# Data transformation
```{r}
library(readxl)
library(tidyverse)
student <- read_excel("Student.xlsx")
teacher<-read_excel("Teacher.xlsx")
parent<-read_excel("Parent.xlsx")
```


## Step1: Change column names

The column names in the original dataset are too long and contain white spaces, which is inconvenient for future development. Moreover, all the column names are the same for student, teacher and parent dataset, thus we cannot discriminate among them after merging these three dataframes in Step2. 

Therefore, for the first step, we change each long column name to a shorter yet clear name, with prefix "s_","t_", and "p_" for student, teacher and parent respectively.

The column names of students response result after transformation is:

```{r}
student_ <- student %>%
  rename(student_rr = `Total Student Response Rate`) %>%
  rename(parent_rr = `Total Parent \r\nResponse Rate`) %>%
  rename(teacher_rr = `Total Teacher Response Rate`) %>%
  rename(name = `School Name`) %>%
  rename(s_trust = `Trust Score`) %>%
  rename(s_collab_teachers = `Collaborative Teachers Score`) %>%
  rename(s_effective_schlead = `Effective School Leadership Score`) %>%
  rename(s_rig_instruction = `Rigorous Instruction Score`) %>%
  rename(s_supp_env = `Supportive Environment Score`) %>%
  rename(s_family_communityties = `Strong Family-Community Ties Score`)
colnames(student_)
```

The column names of teacher response result after transformation is:

```{r}
teacher_ <- teacher %>%
  rename(student_rr = `Total Student Response Rate`) %>%
  rename(parent_rr = `Total Parent \r\nResponse Rate`) %>%
  rename(teacher_rr = `Total Teacher Response Rate`) %>%
  rename(name = `School Name`) %>%
  rename(t_trust = `Trust Score`) %>%
  rename(t_collab_teachers = `Collaborative Teachers Score`) %>%
  rename(t_effective_schlead = `Effective School Leadership Score`) %>%
  rename(t_rig_instruction = `Rigorous Instruction Score`) %>%
  rename(t_supp_env = `Supportive Environment Score`) %>%
  rename(t_family_communityties = `Strong Family-Community Ties Score`)
colnames(teacher_)
```

The column names of parent response result after transformation is:

```{r}
parent_ <- parent %>%
  rename(student_rr = `Total Student Response Rate`) %>%
  rename(parent_rr = `Total Parent \r\nResponse Rate`) %>%
  rename(teacher_rr = `Total Teacher Response Rate`) %>%
  rename(name = `School Name`) %>%
  rename(p_trust = `Trust Score`) %>%
  rename(p_collab_teachers = `Collaborative Teachers Score`) %>%
  rename(p_effective_schlead = `Effective School Leadership Score`) %>%
  rename(p_rig_instruction = `Rigorous Instruction Score`) %>%
  rename(p_supp_env = `Supportive Environment Score`) %>%
  rename(p_family_communityties = `Strong Family-Community Ties Score`)
colnames(parent_)
```

## Step2: Merge Three DataFrames

From the result in Chapter 2 we know that parent, student and teacher response datasets do not have the same row numbers, suggesting that some schools in one dataset may not exist in other datasets. 

```{r}
cat("dim of student is:",dim(student))
cat("dim of parent is:",dim(parent))
cat("dim of teacher is:",dim(teacher))
```

In order to be consistent, we firstly merge the three datasets and only keep those schools who exist in all of these three datasets. Moreover, the parent/teacher/student response rate should be the same in those three datasets, therefore we merge the three datasets by ["DBN","name","parent_rr","student_rr","teacher_rr"]. A summary of the merged dataset is shown as below:

```{r}
st = merge(student_, teacher_,by = c("DBN","name","parent_rr","teacher_rr","student_rr"))
stp = merge(st,parent_,by = c("DBN","name","parent_rr","teacher_rr","student_rr"))

str(stp)

```

## Step3: Change Data Types
After step2, we have a integrated dataset that combines data from student, teacher and parent datasets. However, the data types of many columns are incorrect -- instead of character, they should be float. Therefore, we convert the data type of those columns to `numeric`.

The summary of data after transformation is shown as below:

```{r}
stp$s_collab_teachers <- as.numeric(stp$s_collab_teachers)
stp$s_effective_schlead<- as.numeric(stp$s_effective_schlead)
stp$s_rig_instruction <- as.numeric(stp$s_rig_instruction)
stp$s_supp_env <- as.numeric(stp$s_supp_env)
stp$s_family_communityties <- as.numeric(stp$s_family_communityties)
stp$s_trust <- as.numeric(stp$s_trust)

stp$t_collab_teachers <- as.numeric(stp$t_collab_teachers)
stp$t_effective_schlead<- as.numeric(stp$t_effective_schlead)
stp$t_rig_instruction <- as.numeric(stp$t_rig_instruction)
stp$t_supp_env <- as.numeric(stp$t_supp_env)
stp$t_family_communityties <- as.numeric(stp$t_family_communityties)
stp$t_trust <- as.numeric(stp$t_trust)

stp$p_collab_teachers <- as.numeric(stp$p_collab_teachers)
stp$p_effective_schlead<- as.numeric(stp$p_effective_schlead)
stp$p_rig_instruction <- as.numeric(stp$p_rig_instruction)
stp$p_supp_env <- as.numeric(stp$p_supp_env)
stp$p_family_communityties <- as.numeric(stp$p_family_communityties)
stp$p_trust <- as.numeric(stp$p_trust)

stp$student_rr<-as.numeric(stp$student_rr)
str(stp)

```
## Step4: Tidying data with pivot_longer

Now we have an integrated dataset with correct data types. However, the dataset is still "messy". In order to perform the future data visualization more conveniently, we need to change the "messy data" to "tidy data" with `pivot_longer`.

A summary of the tidy data is shown as below, with variable `aspect` denotes the certain aspect of the school education evaluated by students, parents and teachers. The variable `score` denotes the score of a certain aspect. 

```{r}
tidydata<-stp %>%
  pivot_longer(cols =!c(name,DBN,parent_rr,student_rr,teacher_rr), names_to = "aspect",values_to = "score")

str(tidydata)
```


